---
apiVersion: v1
kind: Namespace
metadata:
  name: podsleuth-test1
---
apiVersion: v1
kind: Namespace
metadata:
  name: podsleuth-test2
---
apiVersion: v1
kind: Namespace
metadata:
  name: podsleuth-test3
---
# Test 1: CrashLoopBackOff - Container exits immediately
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app1-deployment
  namespace: podsleuth-test1
  labels:
    app: app1
    environment: test
spec:
  replicas: 2
  selector:
    matchLabels:
      app: app1
  template:
    metadata:
      labels:
        app: app1
        environment: test
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 10
      - name: crashing-container
        image: busybox:latest
        command: ['sh', '-c', 'exit 1']  # Will crash immediately causing CrashLoopBackOff
---
# Test 2: ImagePullBackOff - Invalid image
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app2-deployment
  namespace: podsleuth-test1
  labels:
    app: app2
    environment: test
spec:
  replicas: 2
  selector:
    matchLabels:
      app: app2
  template:
    metadata:
      labels:
        app: app2
        environment: test
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 10
      - name: invalid-image
        image: invalid-image:does-not-exist  # Will cause ImagePullBackOff
        command: ['sh', '-c', 'sleep 3600']
---
# Test 3: Unready Container - Readiness probe failure
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app3-deployment
  namespace: podsleuth-test2
  labels:
    app: app3
    environment: test
spec:
  replicas: 2
  selector:
    matchLabels:
      app: app3
  template:
    metadata:
      labels:
        app: app3
        environment: test
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 10
      - name: failing-sidecar
        image: busybox:latest
        command: ['sh', '-c', 'sleep 3600']
        readinessProbe:
          httpGet:
            path: /
            port: 8080  # Port doesn't exist, will fail
          initialDelaySeconds: 5
          periodSeconds: 10
          failureThreshold: 1
---
# Test 4: CrashLoopBackOff with sidecar - Main container crashes, sidecar runs
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app4-deployment
  namespace: podsleuth-test2
  labels:
    app: app4
    environment: test
spec:
  replicas: 2
  selector:
    matchLabels:
      app: app4
  template:
    metadata:
      labels:
        app: app4
        environment: test
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 10
      - name: crashing-sidecar
        image: busybox:latest
        command: ['sh', '-c', 'sleep 2 && exit 1']  # Crashes after 2 seconds
---
# Test 5: ImagePullBackOff - Another invalid image scenario
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app5-deployment
  namespace: podsleuth-test3
  labels:
    app: app5
    environment: test
spec:
  replicas: 2
  selector:
    matchLabels:
      app: app5
  template:
    metadata:
      labels:
        app: app5
        environment: test
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 10
      - name: bad-image
        image: registry.invalid/image:tag  # Invalid registry, will cause ImagePullBackOff
        command: ['sh', '-c', 'sleep 3600']
